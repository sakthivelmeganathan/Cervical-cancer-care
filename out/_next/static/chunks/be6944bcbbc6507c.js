(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,49242,e=>{e.v({avatar:"page-module__aUMkAW__avatar",chatArea:"page-module__aUMkAW__chatArea",chatHeader:"page-module__aUMkAW__chatHeader",chatHeaderName:"page-module__aUMkAW__chatHeaderName",chatHeaderStatus:"page-module__aUMkAW__chatHeaderStatus",container:"page-module__aUMkAW__container",emptyChatState:"page-module__aUMkAW__emptyChatState",inputArea:"page-module__aUMkAW__inputArea",inputField:"page-module__aUMkAW__inputField",inputWrapper:"page-module__aUMkAW__inputWrapper",lastMessage:"page-module__aUMkAW__lastMessage",messageBubble:"page-module__aUMkAW__messageBubble",messageTime:"page-module__aUMkAW__messageTime",messagesList:"page-module__aUMkAW__messagesList",received:"page-module__aUMkAW__received",searchBox:"page-module__aUMkAW__searchBox",searchIcon:"page-module__aUMkAW__searchIcon",searchInput:"page-module__aUMkAW__searchInput",sendButton:"page-module__aUMkAW__sendButton",sent:"page-module__aUMkAW__sent",sidebar:"page-module__aUMkAW__sidebar",sidebarHeader:"page-module__aUMkAW__sidebarHeader",sidebarTitle:"page-module__aUMkAW__sidebarTitle",userInfo:"page-module__aUMkAW__userInfo",userItem:"page-module__aUMkAW__userItem",userItemActive:"page-module__aUMkAW__userItemActive",userList:"page-module__aUMkAW__userList",userName:"page-module__aUMkAW__userName"})},16258,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(11795),d=e.i(49242),r=e.i(55436),i=e.i(75254);let l=(0,i.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),c=(0,i.default)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);var n=e.i(83773);function u({currentUserId:e,chats:i,title:u,searchPlaceholder:_,emptyStateMessage:m}){let{t:o}=(0,n.useLanguage)(),h=(0,t.createClient)(),[g,p]=(0,s.useState)(i.length>0?i[0]:null),[f,v]=(0,s.useState)([]),[x,A]=(0,s.useState)(""),[j,k]=(0,s.useState)(""),M=(0,s.useRef)(null),N=u||o("chat.title"),U=_||o("chat.searchPlaceholder"),b=m||o("chat.selectUser"),W=i.filter(e=>e.full_name?.toLowerCase().includes(j.toLowerCase()));(0,s.useEffect)(()=>{if(!g)return;(async()=>{let{data:a,error:s}=await h.from("messages").select("*").or(`and(sender_id.eq.${e},receiver_id.eq.${g.id}),and(sender_id.eq.${g.id},receiver_id.eq.${e})`).order("created_at",{ascending:!0});a&&v(a)})();let a=h.channel("chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${e}`},e=>{e.new.sender_id===g.id&&v(a=>[...a,e.new])}).subscribe();return()=>{h.removeChannel(a)}},[g,e,h]),(0,s.useEffect)(()=>{M.current?.scrollIntoView({behavior:"smooth"})},[f]);let S=async a=>{if(a.preventDefault(),!x.trim()||!g)return;let s=x.trim();A("");let t=Math.random().toString(),d={id:t,sender_id:e,receiver_id:g.id,message:s,created_at:new Date().toISOString()};v(e=>[...e,d]);let{data:r,error:i}=await h.from("messages").insert({sender_id:e,receiver_id:g.id,message:s}).select().single();i?console.error("Error sending message:",i):r&&v(e=>e.map(e=>e.id===t?r:e))};return(0,a.jsxs)("div",{className:d.default.container,children:[(0,a.jsxs)("div",{className:d.default.sidebar,children:[(0,a.jsxs)("div",{className:d.default.sidebarHeader,children:[(0,a.jsx)("h2",{className:d.default.sidebarTitle,children:N}),(0,a.jsxs)("div",{className:d.default.searchBox,children:[(0,a.jsx)(r.Search,{className:d.default.searchIcon,size:18}),(0,a.jsx)("input",{type:"text",placeholder:U,className:d.default.searchInput,value:j,onChange:e=>k(e.target.value)})]})]}),(0,a.jsx)("div",{className:d.default.userList,children:W.map(e=>(0,a.jsxs)("div",{className:`${d.default.userItem} ${g?.id===e.id?d.default.userItemActive:""}`,onClick:()=>p(e),children:[(0,a.jsx)("img",{src:`https://ui-avatars.com/api/?name=${e.full_name}&background=random`,alt:e.full_name,className:d.default.avatar}),(0,a.jsxs)("div",{className:d.default.userInfo,children:[(0,a.jsx)("span",{className:d.default.userName,children:e.full_name}),(0,a.jsx)("span",{className:d.default.lastMessage,children:o("chat.clickToChat")})]})]},e.id))})]}),(0,a.jsx)("div",{className:d.default.chatArea,children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:d.default.chatHeader,children:[(0,a.jsx)("img",{src:`https://ui-avatars.com/api/?name=${g.full_name}&background=random`,alt:g.full_name,className:d.default.avatar,style:{width:40,height:40}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:d.default.chatHeaderName,children:g.full_name}),(0,a.jsxs)("div",{className:d.default.chatHeaderStatus,children:[(0,a.jsx)("div",{style:{width:8,height:8,background:"#16a34a",borderRadius:"50%"}}),o("chat.online")]})]})]}),(0,a.jsxs)("div",{className:d.default.messagesList,children:[f.map(s=>(0,a.jsxs)("div",{className:`${d.default.messageBubble} ${s.sender_id===e?d.default.sent:d.default.received}`,children:[s.message,(0,a.jsx)("span",{className:d.default.messageTime,children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},s.id)),(0,a.jsx)("div",{ref:M})]}),(0,a.jsx)("div",{className:d.default.inputArea,children:(0,a.jsxs)("form",{className:d.default.inputWrapper,onSubmit:S,children:[(0,a.jsx)("input",{type:"text",placeholder:o("chat.typeMessage"),className:d.default.inputField,value:x,onChange:e=>A(e.target.value)}),(0,a.jsx)("button",{type:"submit",className:d.default.sendButton,disabled:!x.trim(),children:(0,a.jsx)(l,{size:18})})]})})]}):(0,a.jsxs)("div",{className:d.default.emptyChatState,children:[(0,a.jsx)(c,{size:48}),(0,a.jsx)("h3",{children:b})]})})]})}e.s(["default",()=>u],16258)},60119,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(18566),d=e.i(11795),r=e.i(16258);function i(){let e=(0,t.useRouter)(),i=(0,t.useSearchParams)().get("doctor"),l=(0,d.createClient)(),[c,n]=(0,s.useState)(!0),[u,_]=(0,s.useState)(null),[m,o]=(0,s.useState)([]);return((0,s.useEffect)(()=>{!async function(){let{data:{user:a}}=await l.auth.getUser();if(!a)return e.push("/login");_(a);let{data:s}=await l.from("patients").select("id").eq("user_id",a.id).single(),t=s?.id,{data:d}=await l.from("appointments").select(`
                    doctor_id,
                    doctor:users!appointments_doctor_id_fkey(id, full_name, role)
                `).eq("patient_id",t).order("created_at",{ascending:!1}),{data:r}=await l.from("messages").select(`
                    sender_id,
                    receiver_id,
                    sender:users!messages_sender_id_fkey(id, full_name, role),
                    receiver:users!messages_receiver_id_fkey(id, full_name, role)
                `).or(`sender_id.eq.${a.id},receiver_id.eq.${a.id}`).order("created_at",{ascending:!1}),c=new Map;d?.forEach(e=>{e.doctor&&e.doctor.id!==a.id&&c.set(e.doctor.id,e.doctor)}),r?.forEach(e=>{e.sender_id===a.id&&e.receiver&&e.receiver.id!==a.id&&c.set(e.receiver.id,e.receiver),e.receiver_id===a.id&&e.sender&&e.sender.id!==a.id&&c.set(e.sender.id,e.sender)});let u=Array.from(c.values());if(i&&!u.some(e=>e.id===i)){let{data:e}=await l.from("users").select("id, full_name, role").eq("id",i).single();e&&(u=[e,...u])}o(u.map(e=>({id:e.id,full_name:e.full_name}))),n(!1)}()},[e,l,i]),c)?(0,a.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading messages..."}):(0,a.jsx)(r.default,{currentUserId:u?.id,chats:m,title:"Your Doctors",searchPlaceholder:"Search doctors...",emptyStateMessage:"Select a doctor to start messaging"})}function l(){return(0,a.jsx)(s.Suspense,{fallback:(0,a.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:(0,a.jsx)(i,{})})}e.s(["default",()=>l,"dynamic",0,"force-static"])}]);