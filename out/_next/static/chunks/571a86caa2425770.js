(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,65358,e=>{"use strict";var t=e.i(71645),a=e.i(18566),i=e.i(11795);function s({table:e,channelName:s,filter:n}){let d=(0,a.useRouter)(),l=(0,i.createClient)();return(0,t.useEffect)(()=>{let t=l.channel(s||`public:${e}`).on("postgres_changes",{event:"*",schema:"public",table:e,filter:n},()=>{console.log(`Change detected in ${e}, refreshing...`),d.refresh()}).subscribe();return()=>{l.removeChannel(t)}},[l,d,e,s,n]),null}e.s(["default",()=>s])},48047,e=>{e.v({actions:"page-module__YGIh_q__actions",container:"page-module__YGIh_q__container",detail:"page-module__YGIh_q__detail",emptyState:"page-module__YGIh_q__emptyState",grid:"page-module__YGIh_q__grid",header:"page-module__YGIh_q__header",label:"page-module__YGIh_q__label",patientAvatar:"page-module__YGIh_q__patientAvatar",patientCard:"page-module__YGIh_q__patientCard",patientDetails:"page-module__YGIh_q__patientDetails",patientEmail:"page-module__YGIh_q__patientEmail",patientHeader:"page-module__YGIh_q__patientHeader",patientInfo:"page-module__YGIh_q__patientInfo"})},90865,e=>{"use strict";var t=e.i(43476),a=e.i(71645),i=e.i(18566),s=e.i(11795),n=e.i(22016),d=e.i(48047),l=e.i(83773),r=e.i(65358);function c({patients:e}){let{t:a}=(0,l.useLanguage)();return(0,t.jsxs)("div",{className:d.default.container,children:[(0,t.jsxs)("header",{className:d.default.header,children:[(0,t.jsx)("h1",{children:a("doctor.patients.title")}),(0,t.jsx)("p",{children:a("doctor.patients.subtitle")})]}),(0,t.jsx)("div",{className:d.default.grid,children:e&&e.length>0?e.map(e=>(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:d.default.patientCard,children:[(0,t.jsxs)("div",{className:d.default.patientHeader,children:[(0,t.jsx)("div",{className:d.default.patientAvatar,children:e.user?.full_name?.charAt(0)||"?"}),(0,t.jsxs)("div",{className:d.default.patientInfo,children:[(0,t.jsx)("h3",{children:e.user?.full_name||a("doctor.patients.card.unknown")}),(0,t.jsx)("p",{className:d.default.patientEmail,children:e.user?.email||a("doctor.patients.card.noEmail")})]})]}),(0,t.jsxs)("div",{className:d.default.patientDetails,children:[e.user?.phone&&(0,t.jsxs)("div",{className:d.default.detail,children:[(0,t.jsxs)("span",{className:d.default.label,children:[a("doctor.patients.card.phone"),":"]}),(0,t.jsx)("span",{children:e.user.phone})]}),e.date_of_birth&&(0,t.jsxs)("div",{className:d.default.detail,children:[(0,t.jsxs)("span",{className:d.default.label,children:[a("doctor.patients.card.dob"),":"]}),(0,t.jsx)("span",{children:new Date(e.date_of_birth).toLocaleDateString()})]}),(0,t.jsxs)("div",{className:d.default.detail,children:[(0,t.jsxs)("span",{className:d.default.label,children:[a("doctor.patients.card.connection"),":"]}),(0,t.jsx)("span",{children:a("doctor.patients.card.connectedViaQR")})]})]}),(0,t.jsx)("div",{className:d.default.actions,children:e.user?.id&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.default,{href:`/doctor/patients/${e.user.id}`,className:"btn btn-primary btn-sm",children:a("doctor.patients.actions.viewDetails")}),(0,t.jsx)(n.default,{href:`/doctor/messages?patient=${e.user.id}`,className:"btn btn-outline btn-sm",children:a("doctor.patients.actions.sendMessage")})]})})]})},e.id)):(0,t.jsx)("div",{className:d.default.emptyState,children:(0,t.jsx)("p",{children:a("doctor.patients.noConnected")})})}),(0,t.jsx)("div",{style:{display:"none"},children:(0,t.jsx)(r.default,{table:"patient_doctors"})})]})}function o(){let e=(0,i.useRouter)(),n=(0,s.createClient)(),[d,l]=(0,a.useState)(!0),[r,o]=(0,a.useState)([]);return((0,a.useEffect)(()=>{!async function(){let{data:{user:t}}=await n.auth.getUser();if(!t)return e.push("/login");let{data:a}=await n.from("patient_doctors").select("patient_id").eq("doctor_id",t.id),i=Array.from(new Set(a?.map(e=>e.patient_id)||[]));if(0===i.length){o([]),l(!1);return}let{data:s}=await n.from("patients").select("id, user_id, date_of_birth").in("id",i),d=s?.map(e=>e.user_id)||[],{data:r}=await n.from("users").select("id, full_name, email, phone, created_at").in("id",d).order("created_at",{ascending:!1});o(await Promise.all((r||[]).map(async e=>{let t=s?.find(t=>t.user_id===e.id);return{id:t?.id||e.id,user:{id:e.id,full_name:e.full_name,email:e.email,phone:e.phone},date_of_birth:t?.date_of_birth||null,lastAppointment:null,hasAppointment:!1}}))),l(!1)}()},[e,n]),d)?(0,t.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading patients..."}):(0,t.jsx)(c,{patients:r})}e.s(["default",()=>o],90865)}]);