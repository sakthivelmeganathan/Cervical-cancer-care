(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,20425,e=>{e.v({appointmentActions:"page-module__sLcGqG__appointmentActions",appointmentCard:"page-module__sLcGqG__appointmentCard",appointmentDate:"page-module__sLcGqG__appointmentDate",appointmentDetails:"page-module__sLcGqG__appointmentDetails",appointmentHeader:"page-module__sLcGqG__appointmentHeader",appointmentTime:"page-module__sLcGqG__appointmentTime",appointmentsList:"page-module__sLcGqG__appointmentsList",container:"page-module__sLcGqG__container",content:"page-module__sLcGqG__content",detail:"page-module__sLcGqG__detail",emptyState:"page-module__sLcGqG__emptyState",header:"page-module__sLcGqG__header",section:"page-module__sLcGqG__section"})},87127,e=>{e.v({dateTimeRow:"BookAppointment-module__TkJM7W__dateTimeRow",form:"BookAppointment-module__TkJM7W__form",loading:"BookAppointment-module__TkJM7W__loading",noDoctors:"BookAppointment-module__TkJM7W__noDoctors"})},70873,e=>{"use strict";var t=e.i(43476),a=e.i(71645),n=e.i(18566),s=e.i(11795),i=e.i(20425),o=e.i(83773),l=e.i(87127),r=e.i(37728);function d({patientId:e,preselectedDoctorId:i}){let o=(0,n.useRouter)(),d=(0,s.createClient)(),[c,p]=(0,a.useState)([]),[m,u]=(0,a.useState)(!0),[h,f]=(0,a.useState)(!1),[g,x]=(0,a.useState)(""),[_,j]=(0,a.useState)(!1),[v,N]=(0,a.useState)(new Date),[y,b]=(0,a.useState)({doctorId:"",appointmentType:"consultation",notes:""});(0,a.useEffect)(()=>{D()},[]);let D=async()=>{let t=[],a=null;if(i){let e=await d.from("users").select("id, full_name, email").eq("id",i).single();e.data&&(t=[e.data]),a=e.error}else{let n=await d.from("patient_doctors").select(`
                    doctor:users (
                        id,
                        full_name,
                        email
                    )
                `).eq("patient_id",e);n.data&&(t=n.data.map(e=>e.doctor).filter(e=>null!==e)),a=n.error}t&&(p(t),i&&t.length>0&&b(e=>({...e,doctorId:t[0].id}))),a&&console.error("Error loading doctors:",JSON.stringify(a,null,2)),u(!1)},w=async t=>{if(t.preventDefault(),x(""),j(!1),f(!0),!v){x("Please select a date"),f(!1);return}try{let t=v instanceof Date?v:new Date,a=new Date(t.getTime()-6e4*t.getTimezoneOffset()).toISOString().split("T")[0],n=new Date(`${a}T00:00:00`),{data:s,error:i}=await d.from("appointments").insert({patient_id:e,doctor_id:y.doctorId,appointment_date:n.toISOString(),appointment_type:y.appointmentType,status:"pending",notes:y.notes||null}).select("*, patient:patients(user:users(full_name))").single();if(i)throw i;if(s){let e=s.patient?.user?.full_name||"A patient",t=new Date(s.appointment_date).toLocaleDateString();await d.from("notifications").insert({user_id:y.doctorId,title:"New Appointment Request",message:`${e} has requested a ${y.appointmentType.replace("_"," ")} appointment on ${t}.`,type:"appointment_request"})}j(!0),b({doctorId:"",appointmentType:"consultation",notes:""}),N(new Date),setTimeout(()=>{o.push("/patient/appointments"),o.refresh()},2e3)}catch(n){let t=n instanceof Error?n:Error("Unknown error");console.error("Booking error full object:",t),console.error("Booking error message:",n.message),console.error("Booking error details:",n.details),console.error("Booking error hint:",n.hint),console.error("Submission Data:",{patientId:e,doctorId:y.doctorId,appointmentDate:v,time:"00:00:00"});let a=t instanceof Error?t.message:"Unknown error";x(`Failed to book: ${a}`)}finally{f(!1)}};return m?(0,t.jsx)("div",{className:l.default.loading,children:"Loading doctors..."}):(0,t.jsxs)("form",{onSubmit:w,className:l.default.form,children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsxs)("label",{htmlFor:"doctor",className:"form-label",children:["Select Doctor ",(0,t.jsx)("span",{style:{color:"var(--color-error)"},children:"*"})]}),i&&c.length>0?(0,t.jsxs)("div",{className:"form-control",style:{padding:"0.75rem",background:"#f8fafc",borderRadius:"8px",border:"1px solid #e2e8f0",color:"#334155"},children:["Dr. ",c[0].full_name,(0,t.jsx)("input",{type:"hidden",value:c[0].id})]}):c.length>0?(0,t.jsxs)("div",{children:[(0,t.jsxs)("select",{id:"doctor",value:y.doctorId,onChange:e=>b({...y,doctorId:e.target.value}),className:"form-select",required:!0,disabled:h,children:[(0,t.jsx)("option",{value:"",children:"Choose a saved doctor..."}),c.map(e=>(0,t.jsxs)("option",{value:e.id,children:["Dr. ",e.full_name]},e.id))]}),(0,t.jsx)("div",{style:{marginTop:"0.5rem",textAlign:"right"},children:(0,t.jsx)("a",{href:"/patient/scan-qr",style:{fontSize:"0.85rem",color:"#3b82f6",textDecoration:"none"},children:"+ Scan new doctor"})})]}):(0,t.jsxs)("div",{style:{padding:"2rem",textAlign:"center",background:"#f8fafc",borderRadius:"12px",border:"1px dashed #cbd5e1"},children:[(0,t.jsx)("p",{style:{marginBottom:"1rem",color:"#64748b"},children:"To book with a new doctor, please scan their QR code."}),(0,t.jsx)("a",{href:"/patient/scan-qr",className:"btn btn-primary",children:"Scan QR Code"})]})]}),c.length>0&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsxs)("label",{htmlFor:"appointmentType",className:"form-label",children:["Appointment Type ",(0,t.jsx)("span",{style:{color:"var(--color-error)"},children:"*"})]}),(0,t.jsxs)("select",{id:"appointmentType",value:y.appointmentType,onChange:e=>b({...y,appointmentType:e.target.value}),className:"form-select",required:!0,disabled:h,children:[(0,t.jsx)("option",{value:"consultation",children:"Consultation"}),(0,t.jsx)("option",{value:"follow_up",children:"Follow-up"}),(0,t.jsx)("option",{value:"screening",children:"Screening"}),(0,t.jsx)("option",{value:"treatment",children:"Treatment"}),(0,t.jsx)("option",{value:"teleconsultation",children:"Teleconsultation"})]})]}),(0,t.jsx)("div",{className:l.default.dateTimeRow,children:(0,t.jsxs)("div",{className:"form-group",style:{flex:1},children:[(0,t.jsxs)("label",{className:"form-label",children:["Preferred Date ",(0,t.jsx)("span",{style:{color:"var(--color-error)"},children:"*"})]}),(0,t.jsx)("div",{className:l.default.calendarWrapper,children:(0,t.jsx)(r.default,{onChange:N,value:v,minDate:new Date,className:"custom-calendar"})}),(0,t.jsx)("p",{className:l.default.helpText,style:{fontSize:"0.8rem",color:"#666",marginTop:"0.5rem"},children:"* The doctor will confirm the specific time."})]})}),(0,t.jsxs)("div",{className:"form-group",children:[(0,t.jsx)("label",{htmlFor:"notes",className:"form-label",children:"Notes (Optional)"}),(0,t.jsx)("textarea",{id:"notes",value:y.notes,onChange:e=>b({...y,notes:e.target.value}),className:"form-textarea",rows:4,placeholder:"Any specific concerns or questions...",disabled:h})]}),g&&(0,t.jsx)("div",{className:"alert alert-error",children:g}),_&&(0,t.jsx)("div",{className:"alert alert-success",children:"âœ… Request sent! Waiting for doctor confirmation. Redirecting..."}),(0,t.jsx)("button",{type:"submit",className:"btn btn-primary",disabled:h||0===c.length,style:{width:"100%"},children:h?"Sending Request...":"Request Appointment"}),0===c.length&&(0,t.jsx)("p",{className:l.default.noDoctors,children:"No doctors available at the moment."})]}),0===c.length&&!m&&(0,t.jsx)("p",{className:l.default.noDoctors,style:{display:"none"}})]})}function c({patientData:e,doctorId:a,upcomingAppointments:n,pastAppointments:s}){let{t:l}=(0,o.useLanguage)();return(0,t.jsxs)("div",{className:i.default.container,children:[(0,t.jsxs)("header",{className:i.default.header,children:[(0,t.jsx)("h1",{children:l("patient.appointments.title")}),(0,t.jsx)("p",{children:l("patient.appointments.subtitle")})]}),(0,t.jsxs)("div",{className:i.default.content,children:[(0,t.jsxs)("section",{className:i.default.section,children:[(0,t.jsx)("h2",{children:l("patient.appointments.bookNew")}),(0,t.jsx)("div",{className:"card",children:e?(0,t.jsx)(d,{patientId:e.id,preselectedDoctorId:a}):(0,t.jsxs)("div",{className:"alert alert-warning",children:[(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:l("patient.appointments.profileIncomplete")})}),(0,t.jsx)("p",{children:l("patient.appointments.completeProfile")})]})})]}),(0,t.jsxs)("section",{className:i.default.section,children:[(0,t.jsx)("h2",{children:l("patient.appointments.upcoming")}),n&&n.length>0?(0,t.jsx)("div",{className:i.default.appointmentsList,children:n.map(e=>(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:i.default.appointmentCard,children:[(0,t.jsxs)("div",{className:i.default.appointmentHeader,children:[(0,t.jsx)("span",{className:i.default.appointmentDate,children:new Date(e.appointment_date).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),(0,t.jsx)("span",{className:i.default.appointmentTime,children:new Date(e.appointment_date).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),(0,t.jsxs)("div",{className:i.default.appointmentDetails,children:[(0,t.jsxs)("div",{className:i.default.detail,children:[(0,t.jsxs)("strong",{children:[l("patient.appointments.doctor"),":"]})," Dr. ",e.doctor?.full_name]}),(0,t.jsxs)("div",{className:i.default.detail,children:[(0,t.jsxs)("strong",{children:[l("patient.appointments.type"),":"]})," ",e.appointment_type.replace("_"," ")]}),e.notes&&(0,t.jsxs)("div",{className:i.default.detail,children:[(0,t.jsxs)("strong",{children:[l("patient.appointments.notes"),":"]})," ",e.notes]})]}),(0,t.jsx)("div",{className:i.default.appointmentActions,children:(0,t.jsx)("span",{className:`badge badge-${"scheduled"===e.status?"primary":"success"}`,children:e.status})})]})},e.id))}):(0,t.jsx)("p",{className:i.default.emptyState,children:l("patient.appointments.noUpcoming")})]}),(0,t.jsxs)("section",{className:i.default.section,children:[(0,t.jsx)("h2",{children:l("patient.appointments.past")}),s&&s.length>0?(0,t.jsx)("div",{className:i.default.appointmentsList,children:s.slice(0,5).map(e=>(0,t.jsx)("div",{className:"card",children:(0,t.jsxs)("div",{className:i.default.appointmentCard,children:[(0,t.jsxs)("div",{className:i.default.appointmentHeader,children:[(0,t.jsx)("span",{className:i.default.appointmentDate,children:new Date(e.appointment_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),(0,t.jsx)("span",{className:`badge badge-${"completed"===e.status?"success":"error"}`,children:e.status})]}),(0,t.jsxs)("div",{className:i.default.appointmentDetails,children:[(0,t.jsxs)("div",{className:i.default.detail,children:[(0,t.jsxs)("strong",{children:[l("patient.appointments.doctor"),":"]})," Dr. ",e.doctor?.full_name]}),(0,t.jsxs)("div",{className:i.default.detail,children:[(0,t.jsxs)("strong",{children:[l("patient.appointments.type"),":"]})," ",e.appointment_type.replace("_"," ")]})]})]})},e.id))}):(0,t.jsx)("p",{className:i.default.emptyState,children:l("patient.appointments.noPast")})]})]})]})}function p(){let e=(0,n.useRouter)(),i=(0,n.useSearchParams)().get("doctor")||void 0,o=(0,s.createClient)(),[l,r]=(0,a.useState)(!0),[d,p]=(0,a.useState)(null);return((0,a.useEffect)(()=>{!async function(){let{data:{user:t}}=await o.auth.getUser();if(!t)return e.push("/login");let{data:a}=await o.from("patients").select("id").eq("user_id",t.id).single();if(!a)return r(!1);let{data:n}=await o.from("appointments").select(`
                    *,
                    doctor:users!appointments_doctor_id_fkey(full_name, email)
                `).eq("patient_id",a.id).order("appointment_date",{ascending:!0}),s=new Date;p({patientData:a,upcomingAppointments:(n||[]).filter(e=>new Date(e.appointment_date)>=s&&"scheduled"===e.status),pastAppointments:(n||[]).filter(e=>new Date(e.appointment_date)<s||"scheduled"!==e.status)}),r(!1)}()},[e,o]),l)?(0,t.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading appointments..."}):(0,t.jsx)(c,{patientData:d?.patientData,doctorId:i,upcomingAppointments:d?.upcomingAppointments||[],pastAppointments:d?.pastAppointments||[]})}function m(){return(0,t.jsx)(a.Suspense,{fallback:(0,t.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading..."}),children:(0,t.jsx)(p,{})})}e.s(["default",()=>m],70873)}]);