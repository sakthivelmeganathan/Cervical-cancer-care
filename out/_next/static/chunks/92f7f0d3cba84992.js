(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,49242,e=>{e.v({avatar:"page-module__aUMkAW__avatar",chatArea:"page-module__aUMkAW__chatArea",chatHeader:"page-module__aUMkAW__chatHeader",chatHeaderName:"page-module__aUMkAW__chatHeaderName",chatHeaderStatus:"page-module__aUMkAW__chatHeaderStatus",container:"page-module__aUMkAW__container",emptyChatState:"page-module__aUMkAW__emptyChatState",inputArea:"page-module__aUMkAW__inputArea",inputField:"page-module__aUMkAW__inputField",inputWrapper:"page-module__aUMkAW__inputWrapper",lastMessage:"page-module__aUMkAW__lastMessage",messageBubble:"page-module__aUMkAW__messageBubble",messageTime:"page-module__aUMkAW__messageTime",messagesList:"page-module__aUMkAW__messagesList",received:"page-module__aUMkAW__received",searchBox:"page-module__aUMkAW__searchBox",searchIcon:"page-module__aUMkAW__searchIcon",searchInput:"page-module__aUMkAW__searchInput",sendButton:"page-module__aUMkAW__sendButton",sent:"page-module__aUMkAW__sent",sidebar:"page-module__aUMkAW__sidebar",sidebarHeader:"page-module__aUMkAW__sidebarHeader",sidebarTitle:"page-module__aUMkAW__sidebarTitle",userInfo:"page-module__aUMkAW__userInfo",userItem:"page-module__aUMkAW__userItem",userItemActive:"page-module__aUMkAW__userItemActive",userList:"page-module__aUMkAW__userList",userName:"page-module__aUMkAW__userName"})},16258,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(11795),l=e.i(49242),d=e.i(55436),i=e.i(75254);let r=(0,i.default)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),u=(0,i.default)("message-circle",[["path",{d:"M2.992 16.342a2 2 0 0 1 .094 1.167l-1.065 3.29a1 1 0 0 0 1.236 1.168l3.413-.998a2 2 0 0 1 1.099.092 10 10 0 1 0-4.777-4.719",key:"1sd12s"}]]);var n=e.i(83773);function c({currentUserId:e,chats:i,title:c,searchPlaceholder:_,emptyStateMessage:m}){let{t:o}=(0,n.useLanguage)(),h=(0,t.createClient)(),[p,g]=(0,s.useState)(i.length>0?i[0]:null),[f,v]=(0,s.useState)([]),[x,A]=(0,s.useState)(""),[j,k]=(0,s.useState)(""),M=(0,s.useRef)(null),N=c||o("chat.title"),U=_||o("chat.searchPlaceholder"),b=m||o("chat.selectUser"),W=i.filter(e=>e.full_name?.toLowerCase().includes(j.toLowerCase()));(0,s.useEffect)(()=>{if(!p)return;(async()=>{let{data:a,error:s}=await h.from("messages").select("*").or(`and(sender_id.eq.${e},receiver_id.eq.${p.id}),and(sender_id.eq.${p.id},receiver_id.eq.${e})`).order("created_at",{ascending:!0});a&&v(a)})();let a=h.channel("chat_messages").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${e}`},e=>{e.new.sender_id===p.id&&v(a=>[...a,e.new])}).subscribe();return()=>{h.removeChannel(a)}},[p,e,h]),(0,s.useEffect)(()=>{M.current?.scrollIntoView({behavior:"smooth"})},[f]);let S=async a=>{if(a.preventDefault(),!x.trim()||!p)return;let s=x.trim();A("");let t=Math.random().toString(),l={id:t,sender_id:e,receiver_id:p.id,message:s,created_at:new Date().toISOString()};v(e=>[...e,l]);let{data:d,error:i}=await h.from("messages").insert({sender_id:e,receiver_id:p.id,message:s}).select().single();i?console.error("Error sending message:",i):d&&v(e=>e.map(e=>e.id===t?d:e))};return(0,a.jsxs)("div",{className:l.default.container,children:[(0,a.jsxs)("div",{className:l.default.sidebar,children:[(0,a.jsxs)("div",{className:l.default.sidebarHeader,children:[(0,a.jsx)("h2",{className:l.default.sidebarTitle,children:N}),(0,a.jsxs)("div",{className:l.default.searchBox,children:[(0,a.jsx)(d.Search,{className:l.default.searchIcon,size:18}),(0,a.jsx)("input",{type:"text",placeholder:U,className:l.default.searchInput,value:j,onChange:e=>k(e.target.value)})]})]}),(0,a.jsx)("div",{className:l.default.userList,children:W.map(e=>(0,a.jsxs)("div",{className:`${l.default.userItem} ${p?.id===e.id?l.default.userItemActive:""}`,onClick:()=>g(e),children:[(0,a.jsx)("img",{src:`https://ui-avatars.com/api/?name=${e.full_name}&background=random`,alt:e.full_name,className:l.default.avatar}),(0,a.jsxs)("div",{className:l.default.userInfo,children:[(0,a.jsx)("span",{className:l.default.userName,children:e.full_name}),(0,a.jsx)("span",{className:l.default.lastMessage,children:o("chat.clickToChat")})]})]},e.id))})]}),(0,a.jsx)("div",{className:l.default.chatArea,children:p?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:l.default.chatHeader,children:[(0,a.jsx)("img",{src:`https://ui-avatars.com/api/?name=${p.full_name}&background=random`,alt:p.full_name,className:l.default.avatar,style:{width:40,height:40}}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:l.default.chatHeaderName,children:p.full_name}),(0,a.jsxs)("div",{className:l.default.chatHeaderStatus,children:[(0,a.jsx)("div",{style:{width:8,height:8,background:"#16a34a",borderRadius:"50%"}}),o("chat.online")]})]})]}),(0,a.jsxs)("div",{className:l.default.messagesList,children:[f.map(s=>(0,a.jsxs)("div",{className:`${l.default.messageBubble} ${s.sender_id===e?l.default.sent:l.default.received}`,children:[s.message,(0,a.jsx)("span",{className:l.default.messageTime,children:new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},s.id)),(0,a.jsx)("div",{ref:M})]}),(0,a.jsx)("div",{className:l.default.inputArea,children:(0,a.jsxs)("form",{className:l.default.inputWrapper,onSubmit:S,children:[(0,a.jsx)("input",{type:"text",placeholder:o("chat.typeMessage"),className:l.default.inputField,value:x,onChange:e=>A(e.target.value)}),(0,a.jsx)("button",{type:"submit",className:l.default.sendButton,disabled:!x.trim(),children:(0,a.jsx)(r,{size:18})})]})})]}):(0,a.jsxs)("div",{className:l.default.emptyChatState,children:[(0,a.jsx)(u,{size:48}),(0,a.jsx)("h3",{children:b})]})})]})}e.s(["default",()=>c],16258)},95470,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(18566),l=e.i(11795),d=e.i(16258);function i(){let e=(0,t.useRouter)(),i=(0,l.createClient)(),[r,u]=(0,s.useState)(!0),[n,c]=(0,s.useState)(null),[_,m]=(0,s.useState)([]);return((0,s.useEffect)(()=>{!async function(){let{data:{user:a}}=await i.auth.getUser();if(!a)return e.push("/login");c(a);let{data:s}=await i.from("patient_doctors").select("patient_id").eq("doctor_id",a.id),t=Array.from(new Set(s?.map(e=>e.patient_id)||[]));if(t.length>0){let{data:e}=await i.from("patients").select(`
                        id,
                        user:users!patients_user_id_fkey(id, full_name, email)
                    `).in("id",t);m(e?.map(e=>{let a=e.user;return{id:a?.id,full_name:a?.full_name,email:a?.email}})||[])}u(!1)}()},[e,i]),r)?(0,a.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:"Loading messages..."}):(0,a.jsx)(d.default,{currentUserId:n?.id,chats:_})}e.s(["default",()=>i,"dynamic",0,"force-static"])}]);